<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>UpscalerJS x2 Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: system-ui, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding: 20px;
}
.container { max-width: 900px; margin: auto; }
button { padding: 8px 14px; margin-right: 6px; }
.preview {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-top: 16px;
}
img {
  max-width: 100%;
  border: 1px solid #334155;
  background: #020617;
}
.status { margin-top: 12px; font-size: 13px; opacity: .85; }
</style>
</head>

<body>
<div class="container">
  <h1>UpscalerJS x2（CDN / GitHub Pages）</h1>

  <input type="file" id="fileInput" accept="image/*">
  <button id="runBtn" disabled>アップスケール x2</button>
  <button id="downloadBtn" disabled>ダウンロード</button>

  <div class="preview">
    <div>
      <p>元画像</p>
      <img id="inputImg">
    </div>
    <div>
      <p>アップスケール後</p>
      <img id="outputImg">
    </div>
  </div>

  <div class="status" id="status">画像を選択してください</div>
</div>

<!-- UpscalerJS UMD -->
<script src="https://cdn.jsdelivr.net/npm/upscaler@1.0.7/dist/umd/upscaler.min.js"></script>

<script>
const fileInput = document.getElementById("fileInput");
const runBtn = document.getElementById("runBtn");
const downloadBtn = document.getElementById("downloadBtn");
const inputImg = document.getElementById("inputImg");
const outputImg = document.getElementById("outputImg");
const status = document.getElementById("status");

let resultUrl = null;

// ✅ 正解：factory 関数として呼ぶ
const upscaler = window.Upscaler({
  model: "x2",
  wasm: {
    threads: false,
    simd: true
  }
});

fileInput.onchange = () => {
  const file = fileInput.files[0];
  if (!file) return;
  inputImg.src = URL.createObjectURL(file);
  runBtn.disabled = false;
  downloadBtn.disabled = true;
  status.textContent = "準備完了";
};

runBtn.onclick = async () => {
  status.textContent = "アップスケール中…";
  runBtn.disabled = true;

  const result = await upscaler.upscale(inputImg);
  outputImg.src = result;
  resultUrl = result;

  downloadBtn.disabled = false;
  status.textContent = "完了";
};

downloadBtn.onclick = () => {
  const a = document.createElement("a");
  a.href = resultUrl;
  a.download = "upscaled_x2.png";
  a.click();
};
</script>
</body>
</html>
