<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>UpscalerJS x2 Demo (CDN only)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: system-ui, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  margin: 0;
  padding: 20px;
}
h1 {
  font-size: 1.2rem;
}
.container {
  max-width: 900px;
  margin: auto;
}
.controls {
  margin-bottom: 16px;
}
button {
  padding: 8px 14px;
  font-size: 14px;
  cursor: pointer;
}
.preview {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}
img {
  max-width: 100%;
  border: 1px solid #334155;
  background: #020617;
}
.status {
  margin-top: 12px;
  font-size: 13px;
  opacity: 0.85;
}
</style>
</head>

<body>
<div class="container">
  <h1>UpscalerJS x2（CDN / GitHub Pages対応）</h1>

  <div class="controls">
    <input type="file" id="fileInput" accept="image/*">
    <button id="runBtn" disabled>アップスケール x2</button>
    <button id="downloadBtn" disabled>結果をダウンロード</button>
  </div>

  <div class="preview">
    <div>
      <p>元画像</p>
      <img id="inputImg">
    </div>
    <div>
      <p>アップスケール後</p>
      <img id="outputImg">
    </div>
  </div>

  <div class="status" id="status">画像を選択してください</div>
</div>

<!-- UpscalerJS -->
<script type="module">
import Upscaler from "https://cdn.jsdelivr.net/npm/upscaler@1.0.7/dist/browser.js";

const fileInput = document.getElementById("fileInput");
const runBtn = document.getElementById("runBtn");
const downloadBtn = document.getElementById("downloadBtn");
const inputImg = document.getElementById("inputImg");
const outputImg = document.getElementById("outputImg");
const status = document.getElementById("status");

let outputBlobUrl = null;

// Upscaler 初期化（軽量 x2 モデル）
const upscaler = new Upscaler({
  model: "x2",
  wasm: {
    threads: false,
    simd: true
  }
});

fileInput.addEventListener("change", () => {
  const file = fileInput.files[0];
  if (!file) return;

  const url = URL.createObjectURL(file);
  inputImg.src = url;
  outputImg.src = "";
  runBtn.disabled = false;
  downloadBtn.disabled = true;
  status.textContent = "準備完了";
});

runBtn.addEventListener("click", async () => {
  runBtn.disabled = true;
  status.textContent = "アップスケール中…（数秒かかります）";

  const result = await upscaler.upscale(inputImg);

  outputImg.src = result;
  outputBlobUrl = result;

  downloadBtn.disabled = false;
  status.textContent = "完了";
});

downloadBtn.addEventListener("click", () => {
  if (!outputBlobUrl) return;

  const a = document.createElement("a");
  a.href = outputBlobUrl;
  a.download = "upscaled_x2.png";
  a.click();
});
</script>
</body>
</html>
